import{j as a}from"./jsx-runtime-u17CrQMm.js";import{r as o}from"./index-Bi6L2ga8.js";import{r as z}from"./index-Dmh4UR0O.js";const K="_trigger_1ludk_9",X="_menu_1ludk_14",Y="_visible_1ludk_29",H="_group_1ludk_41",U="_groupLabel_1ludk_45",J="_separator_1ludk_55",Q="_item_1ludk_65",Z="_disabled_1ludk_78",$="_danger_1ludk_94",R="_icon_1ludk_107",ee="_label_1ludk_118",te="_shortcut_1ludk_122",d={trigger:K,menu:X,visible:Y,group:H,groupLabel:U,separator:J,item:Q,disabled:Z,danger:$,icon:R,label:ee,shortcut:te},ne=(e,r,p)=>{const l=window.scrollX,u=window.scrollY,c=4;let n=0,f=0;switch(p){case"bottom-start":n=e.bottom+u+c,f=e.left+l;break;case"bottom":n=e.bottom+u+c,f=e.left+l+(e.width-r.width)/2;break;case"bottom-end":n=e.bottom+u+c,f=e.right+l-r.width;break;case"top-start":n=e.top+u-r.height-c,f=e.left+l;break;case"top":n=e.top+u-r.height-c,f=e.left+l+(e.width-r.width)/2;break;case"top-end":n=e.top+u-r.height-c,f=e.right+l-r.width;break}return{top:n,left:f}},oe=({item:e,onSelect:r,onNavigate:p})=>{const l=()=>{e.disabled||(e.onClick?.(),r())},u=n=>{n.key==="Enter"||n.key===" "?(n.preventDefault(),l()):n.key==="ArrowDown"?(n.preventDefault(),p?.("down")):n.key==="ArrowUp"&&(n.preventDefault(),p?.("up"))},c=[d.item,e.disabled&&d.disabled,e.danger&&d.danger].filter(Boolean).join(" ");return a.jsxs("div",{className:c,role:"menuitem",tabIndex:e.disabled?-1:0,"aria-disabled":e.disabled,onClick:l,onKeyDown:u,children:[e.icon&&a.jsx("span",{className:d.icon,"aria-hidden":"true",children:e.icon}),a.jsx("span",{className:d.label,children:e.label}),e.shortcut&&a.jsx("span",{className:d.shortcut,"aria-hidden":"true",children:e.shortcut})]})},L=o.forwardRef(({trigger:e,items:r=[],groups:p=[],placement:l="bottom-start",open:u,onOpenChange:c,onSelect:n,minWidth:f=180,closeOnSelect:x=!0,className:q,...T},A)=>{const[P,V]=o.useState(!1),[E,F]=o.useState({top:0,left:0}),[v,k]=o.useState(-1),b=o.useRef(null),_=o.useRef(null),y=o.useRef(new Map);o.useImperativeHandle(A,()=>b.current);const g=u!==void 0,m=g?u:P,I=(p.length>0?p:[{items:r}]).flatMap(t=>t.items).filter(t=>!t.disabled),h=o.useCallback(t=>{g||V(t),c?.(t),t||k(-1)},[g,c]),w=o.useCallback(()=>{if(!b.current||!_.current)return;const t=b.current.getBoundingClientRect(),i=_.current.getBoundingClientRect(),s=ne(t,i,l);F(s)},[l]);o.useEffect(()=>{if(m)return requestAnimationFrame(w),window.addEventListener("resize",w),window.addEventListener("scroll",w,!0),requestAnimationFrame(()=>{const t=y.current.get(0);t&&(t.focus(),k(0))}),()=>{window.removeEventListener("resize",w),window.removeEventListener("scroll",w,!0)}},[m,w]),o.useEffect(()=>{if(!m)return;const t=i=>{const s=i.target;b.current&&!b.current.contains(s)&&_.current&&!_.current.contains(s)&&h(!1)};return document.addEventListener("mousedown",t),()=>document.removeEventListener("mousedown",t)},[m,h]),o.useEffect(()=>{if(!m)return;const t=i=>{i.key==="Escape"&&h(!1)};return document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)},[m,h]);const M=o.useCallback(()=>{h(!m)},[m,h]),S=o.useCallback(t=>{n?.(t),x&&h(!1)},[x,n,h]),B=o.useCallback(t=>{const i=I.length;if(i===0)return;let s;t==="down"?s=v<i-1?v+1:0:s=v>0?v-1:i-1,k(s),y.current.get(s)?.focus()},[v,I.length]),G=o.isValidElement(e)?o.cloneElement(e,{onClick:M,"aria-expanded":m,"aria-haspopup":"menu"}):e,C=p.length>0?p:[{items:r}],O=[d.menu,m&&d.visible,q].filter(Boolean).join(" ");let D=0;const W=a.jsx("div",{ref:_,className:O,style:{top:E.top,left:E.left,minWidth:f},role:"menu","aria-orientation":"vertical",...T,children:C.map((t,i)=>a.jsxs("div",{className:d.group,children:[t.label&&a.jsx("div",{className:d.groupLabel,children:t.label}),t.items.map(s=>{const j=D;return s.disabled||D++,a.jsx("div",{ref:N=>{N&&!s.disabled&&y.current.set(j,N)},children:a.jsx(oe,{item:s,onSelect:()=>S(s),onNavigate:B})},s.id)}),i<C.length-1&&a.jsx("div",{className:d.separator,role:"separator"})]},i))});return a.jsxs(a.Fragment,{children:[a.jsx("div",{ref:b,className:d.trigger,children:G}),m&&z.createPortal(W,document.body)]})});L.displayName="Dropdown";L.__docgenInfo={description:"",methods:[],displayName:"Dropdown",props:{trigger:{required:!0,tsType:{name:"ReactNode"},description:"The trigger element that opens the dropdown"},items:{required:!1,tsType:{name:"Array",elements:[{name:"DropdownItem"}],raw:"DropdownItem[]"},description:"Menu items (flat list or grouped)",defaultValue:{value:"[]",computed:!1}},groups:{required:!1,tsType:{name:"Array",elements:[{name:"DropdownGroup"}],raw:"DropdownGroup[]"},description:"Grouped menu items",defaultValue:{value:"[]",computed:!1}},placement:{required:!1,tsType:{name:"union",raw:`| 'bottom-start'
| 'bottom'
| 'bottom-end'
| 'top-start'
| 'top'
| 'top-end'`,elements:[{name:"literal",value:"'bottom-start'"},{name:"literal",value:"'bottom'"},{name:"literal",value:"'bottom-end'"},{name:"literal",value:"'top-start'"},{name:"literal",value:"'top'"},{name:"literal",value:"'top-end'"}]},description:`Placement of the dropdown
@default 'bottom-start'`,defaultValue:{value:"'bottom-start'",computed:!1}},open:{required:!1,tsType:{name:"boolean"},description:"Whether the dropdown is open (controlled)"},onOpenChange:{required:!1,tsType:{name:"signature",type:"function",raw:"(open: boolean) => void",signature:{arguments:[{type:{name:"boolean"},name:"open"}],return:{name:"void"}}},description:"Callback when open state changes"},onSelect:{required:!1,tsType:{name:"signature",type:"function",raw:"(item: DropdownItem) => void",signature:{arguments:[{type:{name:"DropdownItem"},name:"item"}],return:{name:"void"}}},description:"Callback when an item is selected"},minWidth:{required:!1,tsType:{name:"number"},description:`Minimum width of the dropdown menu
@default 180`,defaultValue:{value:"180",computed:!1}},closeOnSelect:{required:!1,tsType:{name:"boolean"},description:`Whether to close when an item is selected
@default true`,defaultValue:{value:"true",computed:!1}}},composes:["Omit"]};export{L as D};
