{
  "$schema": "https://orion-ds.dev/schema/registry-item.json",
  "name": "dropdown",
  "type": "registry:component",
  "title": "Dropdown",
  "description": "Contextual menu on click",
  "category": "overlays",
  "files": [
    {
      "path": "packages/react/src/components/Dropdown/Dropdown.tsx",
      "type": "registry:component",
      "content": "/**\n * Dropdown Component\n *\n * A menu that appears below a trigger element.\n *\n * @example\n * ```tsx\n * <Dropdown\n *   trigger={<Button>Options</Button>}\n *   items={[\n *     { id: 'edit', label: 'Edit', onClick: handleEdit },\n *     { id: 'delete', label: 'Delete', danger: true, onClick: handleDelete },\n *   ]}\n * />\n * ```\n */\n\nimport {\n  forwardRef,\n  useState,\n  useRef,\n  useEffect,\n  useCallback,\n  cloneElement,\n  isValidElement,\n  useImperativeHandle,\n} from \"react\";\nimport { createPortal } from \"react-dom\";\nimport type {\n  DropdownProps,\n  DropdownItem,\n  DropdownPlacement,\n  DropdownMenuItemProps,\n} from \"./Dropdown.types\";\nimport styles from \"./Dropdown.module.css\";\n\n/**\n * Calculate dropdown position\n */\nconst calculatePosition = (\n  triggerRect: DOMRect,\n  menuRect: DOMRect,\n  placement: DropdownPlacement,\n): { top: number; left: number } => {\n  const scrollX = window.scrollX;\n  const scrollY = window.scrollY;\n  const offset = 4;\n\n  let top = 0;\n  let left = 0;\n\n  switch (placement) {\n    case \"bottom-start\":\n      top = triggerRect.bottom + scrollY + offset;\n      left = triggerRect.left + scrollX;\n      break;\n    case \"bottom\":\n      top = triggerRect.bottom + scrollY + offset;\n      left =\n        triggerRect.left + scrollX + (triggerRect.width - menuRect.width) / 2;\n      break;\n    case \"bottom-end\":\n      top = triggerRect.bottom + scrollY + offset;\n      left = triggerRect.right + scrollX - menuRect.width;\n      break;\n    case \"top-start\":\n      top = triggerRect.top + scrollY - menuRect.height - offset;\n      left = triggerRect.left + scrollX;\n      break;\n    case \"top\":\n      top = triggerRect.top + scrollY - menuRect.height - offset;\n      left =\n        triggerRect.left + scrollX + (triggerRect.width - menuRect.width) / 2;\n      break;\n    case \"top-end\":\n      top = triggerRect.top + scrollY - menuRect.height - offset;\n      left = triggerRect.right + scrollX - menuRect.width;\n      break;\n  }\n\n  return { top, left };\n};\n\n/**\n * Menu Item Component\n */\nconst MenuItem = ({\n  item,\n  onSelect,\n  onNavigate,\n}: DropdownMenuItemProps & {\n  onNavigate?: (direction: \"up\" | \"down\") => void;\n}) => {\n  const handleClick = () => {\n    if (!item.disabled) {\n      item.onClick?.();\n      onSelect();\n    }\n  };\n\n  const handleKeyDown = (e: React.KeyboardEvent) => {\n    if (e.key === \"Enter\" || e.key === \" \") {\n      e.preventDefault();\n      handleClick();\n    } else if (e.key === \"ArrowDown\") {\n      e.preventDefault();\n      onNavigate?.(\"down\");\n    } else if (e.key === \"ArrowUp\") {\n      e.preventDefault();\n      onNavigate?.(\"up\");\n    }\n  };\n\n  const itemClasses = [\n    styles.item,\n    item.disabled && styles.disabled,\n    item.danger && styles.danger,\n  ]\n    .filter(Boolean)\n    .join(\" \");\n\n  return (\n    <div\n      className={itemClasses}\n      role=\"menuitem\"\n      tabIndex={item.disabled ? -1 : 0}\n      aria-disabled={item.disabled}\n      onClick={handleClick}\n      onKeyDown={handleKeyDown}\n    >\n      {item.icon && (\n        <span className={styles.icon} aria-hidden=\"true\">\n          {item.icon}\n        </span>\n      )}\n      <span className={styles.label}>{item.label}</span>\n      {item.shortcut && (\n        <span className={styles.shortcut} aria-hidden=\"true\">\n          {item.shortcut}\n        </span>\n      )}\n    </div>\n  );\n};\n\nexport const Dropdown = forwardRef<HTMLDivElement, DropdownProps>(\n  (\n    {\n      trigger,\n      items = [],\n      groups = [],\n      placement = \"bottom-start\",\n      open: controlledOpen,\n      onOpenChange,\n      onSelect,\n      minWidth = 180,\n      closeOnSelect = true,\n      className,\n      ...rest\n    },\n    ref,\n  ) => {\n    const [internalOpen, setInternalOpen] = useState(false);\n    const [position, setPosition] = useState({ top: 0, left: 0 });\n    const [focusedIndex, setFocusedIndex] = useState(-1);\n\n    const triggerRef = useRef<HTMLDivElement>(null);\n    const menuRef = useRef<HTMLDivElement>(null);\n    const itemRefs = useRef<Map<number, HTMLDivElement>>(new Map());\n\n    // Expose the trigger element via ref\n    useImperativeHandle(ref, () => triggerRef.current as HTMLDivElement);\n\n    const isControlled = controlledOpen !== undefined;\n    const isOpen = isControlled ? controlledOpen : internalOpen;\n\n    // Flatten all items for navigation\n    const allItemsFlat = (groups.length > 0 ? groups : [{ items }])\n      .flatMap((group) => group.items)\n      .filter((item) => !item.disabled);\n\n    const setIsOpen = useCallback(\n      (newOpen: boolean) => {\n        if (!isControlled) {\n          setInternalOpen(newOpen);\n        }\n        onOpenChange?.(newOpen);\n        if (!newOpen) {\n          setFocusedIndex(-1);\n        }\n      },\n      [isControlled, onOpenChange],\n    );\n\n    // Update position when open\n    const updatePosition = useCallback(() => {\n      if (!triggerRef.current || !menuRef.current) return;\n\n      const triggerRect = triggerRef.current.getBoundingClientRect();\n      const menuRect = menuRef.current.getBoundingClientRect();\n      const newPosition = calculatePosition(triggerRect, menuRect, placement);\n      setPosition(newPosition);\n    }, [placement]);\n\n    useEffect(() => {\n      if (isOpen) {\n        requestAnimationFrame(updatePosition);\n        window.addEventListener(\"resize\", updatePosition);\n        window.addEventListener(\"scroll\", updatePosition, true);\n\n        // Focus first item when menu opens\n        requestAnimationFrame(() => {\n          const firstItem = itemRefs.current.get(0);\n          if (firstItem) {\n            firstItem.focus();\n            setFocusedIndex(0);\n          }\n        });\n\n        return () => {\n          window.removeEventListener(\"resize\", updatePosition);\n          window.removeEventListener(\"scroll\", updatePosition, true);\n        };\n      }\n    }, [isOpen, updatePosition]);\n\n    // Handle click outside\n    useEffect(() => {\n      if (!isOpen) return;\n\n      const handleClickOutside = (event: MouseEvent) => {\n        const target = event.target as Node;\n        if (\n          triggerRef.current &&\n          !triggerRef.current.contains(target) &&\n          menuRef.current &&\n          !menuRef.current.contains(target)\n        ) {\n          setIsOpen(false);\n        }\n      };\n\n      document.addEventListener(\"mousedown\", handleClickOutside);\n      return () =>\n        document.removeEventListener(\"mousedown\", handleClickOutside);\n    }, [isOpen, setIsOpen]);\n\n    // Handle escape key\n    useEffect(() => {\n      if (!isOpen) return;\n\n      const handleEscape = (event: KeyboardEvent) => {\n        if (event.key === \"Escape\") {\n          setIsOpen(false);\n        }\n      };\n\n      document.addEventListener(\"keydown\", handleEscape);\n      return () => document.removeEventListener(\"keydown\", handleEscape);\n    }, [isOpen, setIsOpen]);\n\n    const handleToggle = useCallback(() => {\n      setIsOpen(!isOpen);\n    }, [isOpen, setIsOpen]);\n\n    const handleItemSelect = useCallback(\n      (item: DropdownItem) => {\n        onSelect?.(item);\n        if (closeOnSelect) {\n          setIsOpen(false);\n        }\n      },\n      [closeOnSelect, onSelect, setIsOpen],\n    );\n\n    // Handle keyboard navigation\n    const handleNavigate = useCallback(\n      (direction: \"up\" | \"down\") => {\n        const totalItems = allItemsFlat.length;\n        if (totalItems === 0) return;\n\n        let newIndex: number;\n        if (direction === \"down\") {\n          newIndex = focusedIndex < totalItems - 1 ? focusedIndex + 1 : 0;\n        } else {\n          newIndex = focusedIndex > 0 ? focusedIndex - 1 : totalItems - 1;\n        }\n\n        setFocusedIndex(newIndex);\n        const itemElement = itemRefs.current.get(newIndex);\n        itemElement?.focus();\n      },\n      [focusedIndex, allItemsFlat.length],\n    );\n\n    // Clone trigger with props\n    const triggerElement = isValidElement(trigger)\n      ? cloneElement(trigger as React.ReactElement<Record<string, unknown>>, {\n          onClick: handleToggle,\n          \"aria-expanded\": isOpen,\n          \"aria-haspopup\": \"menu\",\n        })\n      : trigger;\n\n    // Determine all items to render\n    const allItems = groups.length > 0 ? groups : [{ items }];\n\n    const menuClasses = [styles.menu, isOpen && styles.visible, className]\n      .filter(Boolean)\n      .join(\" \");\n\n    // Track flat index for ref assignment\n    let flatIndex = 0;\n\n    const menuElement = (\n      <div\n        ref={menuRef}\n        className={menuClasses}\n        style={{\n          top: position.top,\n          left: position.left,\n          minWidth,\n        }}\n        role=\"menu\"\n        aria-orientation=\"vertical\"\n        {...rest}\n      >\n        {allItems.map((group, groupIndex) => (\n          <div key={groupIndex} className={styles.group}>\n            {group.label && (\n              <div className={styles.groupLabel}>{group.label}</div>\n            )}\n            {group.items.map((item) => {\n              const currentIndex = flatIndex;\n              if (!item.disabled) {\n                flatIndex++;\n              }\n              return (\n                <div\n                  key={item.id}\n                  ref={(el) => {\n                    if (el && !item.disabled) {\n                      itemRefs.current.set(currentIndex, el);\n                    }\n                  }}\n                >\n                  <MenuItem\n                    item={item}\n                    onSelect={() => handleItemSelect(item)}\n                    onNavigate={handleNavigate}\n                  />\n                </div>\n              );\n            })}\n            {groupIndex < allItems.length - 1 && (\n              <div className={styles.separator} role=\"separator\" />\n            )}\n          </div>\n        ))}\n      </div>\n    );\n\n    return (\n      <>\n        <div ref={triggerRef} className={styles.trigger}>\n          {triggerElement}\n        </div>\n        {isOpen && createPortal(menuElement, document.body)}\n      </>\n    );\n  },\n);\n\nDropdown.displayName = \"Dropdown\";\n"
    },
    {
      "path": "packages/react/src/components/Dropdown/Dropdown.types.ts",
      "type": "registry:types",
      "content": "/**\n * Dropdown Component Types\n *\n * Type definitions for the Orion Dropdown/Menu component.\n */\n\nimport type { HTMLAttributes, ReactNode } from \"react\";\n\n/**\n * Dropdown placement options\n */\nexport type DropdownPlacement =\n  | \"bottom-start\"\n  | \"bottom\"\n  | \"bottom-end\"\n  | \"top-start\"\n  | \"top\"\n  | \"top-end\";\n\n/**\n * Dropdown menu item\n */\nexport interface DropdownItem {\n  /**\n   * Unique identifier for the item\n   */\n  id: string;\n\n  /**\n   * Label to display\n   */\n  label: string;\n\n  /**\n   * Optional icon to display before the label\n   */\n  icon?: ReactNode;\n\n  /**\n   * Whether the item is disabled\n   */\n  disabled?: boolean;\n\n  /**\n   * Whether this is a destructive action (red text)\n   */\n  danger?: boolean;\n\n  /**\n   * Optional keyboard shortcut to display\n   */\n  shortcut?: string;\n\n  /**\n   * Click handler for the item\n   */\n  onClick?: () => void;\n}\n\n/**\n * Dropdown item group (for organizing items)\n */\nexport interface DropdownGroup {\n  /**\n   * Optional label for the group\n   */\n  label?: string;\n\n  /**\n   * Items in this group\n   */\n  items: DropdownItem[];\n}\n\n/**\n * Dropdown component props\n *\n * @example\n * ```tsx\n * <Dropdown\n *   trigger={<Button>Options</Button>}\n *   items={[\n *     { id: 'edit', label: 'Edit', icon: <EditIcon /> },\n *     { id: 'delete', label: 'Delete', danger: true },\n *   ]}\n * />\n * ```\n */\nexport interface DropdownProps extends Omit<\n  HTMLAttributes<HTMLDivElement>,\n  \"onChange\" | \"onSelect\"\n> {\n  /**\n   * The trigger element that opens the dropdown\n   */\n  trigger: ReactNode;\n\n  /**\n   * Menu items (flat list or grouped)\n   */\n  items?: DropdownItem[];\n\n  /**\n   * Grouped menu items\n   */\n  groups?: DropdownGroup[];\n\n  /**\n   * Placement of the dropdown\n   * @default 'bottom-start'\n   */\n  placement?: DropdownPlacement;\n\n  /**\n   * Whether the dropdown is open (controlled)\n   */\n  open?: boolean;\n\n  /**\n   * Callback when open state changes\n   */\n  onOpenChange?: (open: boolean) => void;\n\n  /**\n   * Callback when an item is selected\n   */\n  onSelect?: (item: DropdownItem) => void;\n\n  /**\n   * Minimum width of the dropdown menu\n   * @default 180\n   */\n  minWidth?: number;\n\n  /**\n   * Whether to close when an item is selected\n   * @default true\n   */\n  closeOnSelect?: boolean;\n}\n\n/**\n * Dropdown Item component props (internal)\n */\nexport interface DropdownMenuItemProps {\n  item: DropdownItem;\n  onSelect: () => void;\n}\n"
    },
    {
      "path": "packages/react/src/components/Dropdown/Dropdown.module.css",
      "type": "registry:styles",
      "content": "/**\n * Dropdown Component Styles\n *\n * Uses CSS Modules for scoped styling.\n * All values reference semantic tokens via CSS variables.\n */\n\n/* Trigger wrapper */\n.trigger {\n  display: inline-block;\n}\n\n/* Menu container */\n.menu {\n  position: absolute;\n  z-index: var(--z-dropdown);\n  background: var(--surface-base);\n  border: 1px solid var(--border-subtle);\n  border-radius: var(--radius-control);\n  box-shadow: var(--shadow-lg);\n  padding: var(--spacing-2);\n  opacity: 0;\n  visibility: hidden;\n  transform: translateY(-4px);\n  transition:\n    opacity var(--transition-fast),\n    transform var(--transition-fast),\n    visibility 0s linear var(--transition-fast);\n}\n\n.visible {\n  opacity: 1;\n  visibility: visible;\n  transform: translateY(0);\n  transition:\n    opacity var(--transition-fast),\n    transform var(--transition-fast),\n    visibility 0s linear 0s;\n}\n\n/* ============================================================================\n * GROUPS\n * ============================================================================ */\n\n.group {\n  /* No specific styles needed */\n}\n\n.groupLabel {\n  padding: var(--spacing-2) var(--spacing-3);\n  font-family: var(--font-secondary);\n  font-size: var(--font-size-12);\n  font-weight: var(--font-weight-medium);\n  color: var(--text-tertiary);\n  text-transform: uppercase;\n  letter-spacing: 0.05em;\n}\n\n.separator {\n  height: 1px;\n  margin: var(--spacing-2) 0;\n  background: var(--border-subtle);\n}\n\n/* ============================================================================\n * MENU ITEM\n * ============================================================================ */\n\n.item {\n  display: flex;\n  align-items: center;\n  gap: var(--spacing-3);\n  padding: var(--spacing-3) var(--spacing-4);\n  border-radius: var(--radius-sm);\n  font-family: var(--font-secondary);\n  font-size: var(--font-size-14);\n  color: var(--text-primary);\n  cursor: pointer;\n  transition: background-color var(--transition-fast);\n  outline: none;\n\n  &:hover:not(.disabled),\n  &:focus-visible:not(.disabled) {\n    background: var(--surface-subtle);\n  }\n\n  &:focus-visible {\n    outline: 2px solid var(--interactive-primary);\n    outline-offset: -2px;\n  }\n}\n\n.disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n\n.danger {\n  color: var(--status-error);\n\n  &:hover:not(.disabled),\n  &:focus-visible:not(.disabled) {\n    background: color-mix(in srgb, var(--status-error) 10%, transparent);\n  }\n}\n\n/* ============================================================================\n * ITEM PARTS\n * ============================================================================ */\n\n.icon {\n  width: 16px;\n  height: 16px;\n  flex-shrink: 0;\n  color: var(--text-secondary);\n\n  .danger & {\n    color: var(--status-error);\n  }\n}\n\n.label {\n  flex: 1;\n}\n\n.shortcut {\n  font-size: var(--font-size-12);\n  color: var(--text-tertiary);\n  font-family: var(--font-mono);\n}\n\n/* ============================================================================\n * REDUCED MOTION\n * ============================================================================ */\n\n@media (prefers-reduced-motion: reduce) {\n  .menu {\n    transition: none;\n  }\n}\n"
    },
    {
      "path": "packages/react/src/components/Dropdown/index.ts",
      "type": "registry:index",
      "content": "/**\n * Dropdown Component - Action menu with items.\n *\n * @example\n * ```tsx\n * import { Dropdown, Button } from '@orion-ds/react';\n * import { Edit, Trash, Copy } from 'lucide-react';\n *\n * <Dropdown\n *   trigger={<Button>Actions</Button>}\n *   items={[\n *     { label: 'Edit', icon: <Edit size={16} />, onClick: handleEdit },\n *     { label: 'Duplicate', icon: <Copy size={16} />, onClick: handleCopy },\n *     { type: 'divider' },\n *     { label: 'Delete', icon: <Trash size={16} />, onClick: handleDelete, danger: true },\n *   ]}\n * />\n * ```\n */\nexport { Dropdown } from \"./Dropdown\";\nexport type {\n  DropdownProps,\n  DropdownItem,\n  DropdownGroup,\n  DropdownPlacement,\n} from \"./Dropdown.types\";\n"
    }
  ],
  "props": [
    {
      "name": "trigger",
      "type": "ReactNode",
      "description": "The trigger element that opens the dropdown",
      "required": true
    },
    {
      "name": "items",
      "type": "DropdownItem[]",
      "description": "Menu items (flat list or grouped)"
    },
    {
      "name": "groups",
      "type": "DropdownGroup[]",
      "description": "Grouped menu items"
    },
    {
      "name": "placement",
      "type": "DropdownPlacement",
      "description": "Placement of the dropdown",
      "default": "bottom-start",
      "values": [
        "bottom-start",
        "bottom",
        "bottom-end",
        "top-start",
        "top",
        "top-end"
      ]
    },
    {
      "name": "open",
      "type": "boolean",
      "description": "Whether the dropdown is open (controlled)"
    },
    {
      "name": "onOpenChange",
      "type": "(open: boolean) => void",
      "description": "Callback when open state changes"
    },
    {
      "name": "onSelect",
      "type": "(item: DropdownItem) => void",
      "description": "Callback when an item is selected"
    },
    {
      "name": "minWidth",
      "type": "number",
      "description": "Minimum width of the dropdown menu",
      "default": 180
    },
    {
      "name": "closeOnSelect",
      "type": "boolean",
      "description": "Whether to close when an item is selected",
      "default": true
    }
  ],
  "tokens": [
    "--surface-base",
    "--border-subtle",
    "--text-primary",
    "--radius-control",
    "--shadow-lg"
  ],
  "examples": [
    {
      "title": "Basic dropdown",
      "code": "<Dropdown\n  trigger={<Button variant=\"secondary\">Options</Button>}\n  items={[\n    { label: 'Edit', onClick: handleEdit },\n    { label: 'Duplicate', onClick: handleDuplicate },\n    { type: 'separator' },\n    { label: 'Delete', onClick: handleDelete, destructive: true },\n  ]}\n/>"
    }
  ],
  "accessibility": {
    "role": "menu",
    "ariaAttributes": [
      "aria-haspopup",
      "aria-expanded"
    ],
    "keyboardNav": [
      {
        "key": "Enter/Space",
        "action": "Open/select"
      },
      {
        "key": "ArrowUp/Down",
        "action": "Navigate items"
      },
      {
        "key": "Escape",
        "action": "Close menu"
      }
    ]
  },
  "modeAware": false,
  "preview": {
    "url": "https://orion-ds.dev/library.html#dropdown",
    "local": "/library.html#dropdown"
  },
  "import": "import { Dropdown } from '@orion-ds/react'",
  "cssImport": "import '@orion-ds/react/styles.css'"
}
