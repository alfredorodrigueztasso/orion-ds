{
  "$schema": "https://orion-ds.dev/schema/registry-item.json",
  "name": "collapsible-folder",
  "type": "registry:section",
  "title": "CollapsibleFolder",
  "description": "CollapsibleFolder section component",
  "category": "marketing",
  "files": [
    {
      "path": "packages/react/src/sections/CollapsibleFolder/CollapsibleFolder.tsx",
      "type": "registry:component",
      "content": "/**\n * CollapsibleFolder Section\n *\n * Generic collapsible folder section for organizing items in a grid layout.\n * Supports native HTML5 drag & drop with visual feedback, sorting, and folder management actions.\n *\n * ## Drag & Drop Features\n * - **Drop target visual state**: Folder highlights when dragging items over it\n * - **Insertion indicator**: Dynamic line shows exactly where the item will be inserted\n * - **Automatic state cleanup**: Visual feedback clears when drag ends or user leaves folder\n * - **Empty folder support**: Shows centered insertion line for empty folders\n * - **Collapsed folder support**: Accepts drops even when folder is collapsed\n *\n * ## Customization\n * Use `renderItem` to render your custom items. See CollapsibleFolder stories and AgentFolder for examples.\n */\n\nimport React, { useRef, useState } from \"react\";\nimport { useDroppable } from \"@dnd-kit/core\";\nimport type { CollapsibleFolderProps } from \"./CollapsibleFolder.types\";\nimport { Collapsible } from \"../../components/Collapsible\";\nimport { Dropdown } from \"../../components/Dropdown\";\nimport { Badge } from \"../../components/Badge\";\nimport { Button } from \"../../components/Button\";\nimport { ChevronDown, MoreHorizontal } from \"lucide-react\";\nimport styles from \"./CollapsibleFolder.module.css\";\n\nexport function CollapsibleFolder<\n  TItem extends { id: string; draggable?: boolean },\n>(props: CollapsibleFolderProps<TItem>) {\n  const {\n    id,\n    title,\n    itemCount,\n    items,\n    renderItem,\n    itemLabel = \"Item\",\n    itemLabelPlural = \"Items\",\n    emptyText = \"No items in this folder\",\n    sortLabel = \"Sort\",\n    defaultExpanded = true,\n    sortOptions,\n    selectedSort,\n    onSortChange,\n    onDrop,\n    onFolderEdit,\n    onFolderDelete,\n    onFolderInvite,\n    isDropTarget = false,\n    isDropCompleted = false,\n    onDragEnter,\n    onDragLeaveFolder,\n    className,\n    ...rest\n  } = props;\n\n  const [isExpanded, setIsExpanded] = useState(defaultExpanded);\n  const [insertionIndex, setInsertionIndex] = useState<number | null>(null);\n  const [isLocalDropTarget, setIsLocalDropTarget] = useState(false);\n  const gridRef = useRef<HTMLDivElement>(null);\n  const { setNodeRef } = useDroppable({ id });\n\n  const handleDragOver = (e: React.DragEvent<HTMLDivElement>) => {\n    e.preventDefault();\n    e.dataTransfer.dropEffect = \"move\";\n\n    // Notify parent that drag is over this folder\n    if (!isLocalDropTarget) {\n      setIsLocalDropTarget(true);\n      onDragEnter?.();\n    }\n\n    // Calculate insertion index based on cursor position\n    if (!isExpanded || items.length === 0) {\n      setInsertionIndex(0);\n      return;\n    }\n\n    const gridEl = gridRef.current;\n    if (!gridEl) return;\n\n    const itemElements = Array.from(\n      gridEl.querySelectorAll(\"[data-item-id]\"),\n    ) as HTMLElement[];\n    const cursorY = e.clientY;\n    let idx = itemElements.length;\n\n    for (let i = 0; i < itemElements.length; i++) {\n      const item = itemElements[i];\n      if (!item) continue;\n      const rect = item.getBoundingClientRect();\n      if (cursorY < rect.top + rect.height / 2) {\n        idx = i;\n        break;\n      }\n    }\n\n    setInsertionIndex(idx);\n  };\n\n  const handleDragLeave = (e: React.DragEvent<HTMLDivElement>) => {\n    if (!e.currentTarget.contains(e.relatedTarget as Node)) {\n      setIsLocalDropTarget(false);\n      setInsertionIndex(null);\n      onDragLeaveFolder?.();\n    }\n  };\n\n  const handleDrop = (e: React.DragEvent<HTMLDivElement>) => {\n    e.preventDefault();\n    // Try \"text/plain\" first (from native drag), fallback to \"itemId\"\n    const itemId =\n      e.dataTransfer.getData(\"text/plain\") || e.dataTransfer.getData(\"itemId\");\n    if (itemId && onDrop) {\n      const index = insertionIndex ?? items.length;\n      onDrop(itemId, id, index);\n    }\n    // Clean up drag state\n    setIsLocalDropTarget(false);\n    setInsertionIndex(null);\n    onDragLeaveFolder?.();\n  };\n\n  const handleDragStart = (\n    e: React.DragEvent<HTMLDivElement>,\n    itemId: string,\n  ) => {\n    e.dataTransfer.effectAllowed = \"move\";\n    e.dataTransfer.setData(\"text/plain\", itemId);\n  };\n\n  // Build sort dropdown items\n  const sortDropdownItems = sortOptions?.map((option) => ({\n    id: option.value,\n    label: option.label,\n    onClick: () => onSortChange?.(option.value),\n  }));\n\n  // Build folder actions dropdown\n  const folderActionsItems = [\n    ...(onFolderEdit\n      ? [\n          {\n            id: \"rename\",\n            label: \"Rename\",\n            onClick: onFolderEdit,\n          },\n        ]\n      : []),\n    ...(onFolderInvite\n      ? [\n          {\n            id: \"invite\",\n            label: \"Invite participants\",\n            onClick: onFolderInvite,\n          },\n        ]\n      : []),\n    ...(onFolderDelete\n      ? [\n          {\n            id: \"delete\",\n            label: \"Delete folder\",\n            danger: true,\n            onClick: onFolderDelete,\n          },\n        ]\n      : []),\n  ];\n\n  const isActiveDropTarget = isDropTarget || isLocalDropTarget;\n\n  const classNames = [\n    styles.folder,\n    isActiveDropTarget && styles.dropTarget,\n    isDropCompleted && styles.dropCompleted,\n    className,\n  ]\n    .filter(Boolean)\n    .join(\" \");\n\n  const itemLabelDisplay = itemCount === 1 ? itemLabel : itemLabelPlural;\n\n  return (\n    <div\n      ref={setNodeRef}\n      className={classNames}\n      data-folder-id={id}\n      data-drop-active={isActiveDropTarget}\n      onDragOver={handleDragOver}\n      onDragLeave={handleDragLeave}\n      onDrop={handleDrop}\n      {...rest}\n    >\n      <Collapsible open={isExpanded} onOpenChange={setIsExpanded}>\n        {/* Folder Header */}\n        <div className={styles.header}>\n          <Collapsible.Trigger className={styles.trigger}>\n            <ChevronDown\n              size={20}\n              className={`${styles.chevron} ${isExpanded ? styles.expanded : \"\"}`}\n            />\n            <h2 className={styles.title}>{title}</h2>\n            <Badge variant=\"neutral\" className={styles.badge}>\n              {itemCount}\n              <span className={styles.badgeLabel}> {itemLabelDisplay}</span>\n            </Badge>\n          </Collapsible.Trigger>\n\n          <div className={styles.actions}>\n            {/* Sort dropdown */}\n            {sortOptions && sortOptions.length > 0 && (\n              <div className={styles.sortDropdown}>\n                <Dropdown\n                  trigger={\n                    <Button\n                      variant=\"ghost\"\n                      size=\"sm\"\n                      iconRight={<ChevronDown size={16} />}\n                      aria-label={`Sort by ${sortLabel}`}\n                    >\n                      {sortOptions.find((opt) => opt.value === selectedSort)\n                        ?.label || sortLabel}\n                    </Button>\n                  }\n                  items={sortDropdownItems}\n                  placement=\"bottom-end\"\n                />\n              </div>\n            )}\n\n            {/* Folder actions menu */}\n            {folderActionsItems.length > 0 && (\n              <Dropdown\n                trigger={\n                  <Button\n                    variant=\"ghost\"\n                    size=\"sm\"\n                    iconOnly\n                    icon={<MoreHorizontal size={20} />}\n                    aria-label=\"Folder actions\"\n                  />\n                }\n                items={folderActionsItems}\n                placement=\"bottom-end\"\n              />\n            )}\n          </div>\n        </div>\n\n        {/* Items Grid */}\n        <Collapsible.Content>\n          <div className={styles.content}>\n            {items.length === 0 ? (\n              isActiveDropTarget ? (\n                <div className={styles.emptyDropZone}>\n                  <div className={styles.insertionLine} role=\"presentation\" />\n                </div>\n              ) : (\n                <div className={styles.emptyState}>\n                  <p className={styles.emptyText}>{emptyText}</p>\n                </div>\n              )\n            ) : (\n              <div className={styles.grid} ref={gridRef}>\n                {items.map((item, index) => (\n                  <React.Fragment key={item.id}>\n                    {isActiveDropTarget && insertionIndex === index && (\n                      <div\n                        className={styles.insertionLine}\n                        role=\"presentation\"\n                      />\n                    )}\n                    <div\n                      data-item-id={item.id}\n                      draggable={item.draggable}\n                      onDragStart={(e) => handleDragStart(e, item.id)}\n                    >\n                      {renderItem(item, index)}\n                    </div>\n                  </React.Fragment>\n                ))}\n                {isActiveDropTarget && insertionIndex === items.length && (\n                  <div className={styles.insertionLine} role=\"presentation\" />\n                )}\n              </div>\n            )}\n          </div>\n        </Collapsible.Content>\n      </Collapsible>\n    </div>\n  );\n}\n\nCollapsibleFolder.displayName = \"CollapsibleFolder\";\n"
    },
    {
      "path": "packages/react/src/sections/CollapsibleFolder/CollapsibleFolder.types.ts",
      "type": "registry:types",
      "content": "/**\n * CollapsibleFolder Section Types\n *\n * Type definitions for the CollapsibleFolder section - generic collapsible container\n * for organizing items with drag & drop support.\n */\n\nimport type { HTMLAttributes } from \"react\";\nimport type { SortOption } from \"../AgentFolder/AgentFolder.types\";\n\nexport type { SortOption };\n\n/**\n * CollapsibleFolder component props\n *\n * Generic folder component that can contain any type of items (agents, files, documents, etc.)\n * with drag & drop, sorting, and folder management features.\n *\n * @template TItem - The type of items in the folder. Must have `id` property and optional `draggable` boolean.\n *\n * @example\n * ```tsx\n * // With files\n * <CollapsibleFolder\n *   id=\"folder-1\"\n *   title=\"Documents\"\n *   itemCount={3}\n *   items={files}\n *   itemLabel=\"File\"\n *   itemLabelPlural=\"Files\"\n *   emptyText=\"No files in this folder\"\n *   renderItem={(file) => <FileCard {...file} />}\n * />\n *\n * // With custom items\n * <CollapsibleFolder\n *   id=\"folder-2\"\n *   title=\"Projects\"\n *   itemCount={2}\n *   items={projects}\n *   itemLabel=\"Project\"\n *   itemLabelPlural=\"Projects\"\n *   renderItem={(project) => (\n *     <div>{project.name} - {project.status}</div>\n *   )}\n * />\n * ```\n */\nexport interface CollapsibleFolderProps<\n  TItem extends { id: string; draggable?: boolean; [key: string]: any },\n> extends Omit<HTMLAttributes<HTMLDivElement>, \"onDrop\"> {\n  /**\n   * Unique folder identifier\n   */\n  id: string;\n\n  /**\n   * Folder title/name\n   */\n  title: string;\n\n  /**\n   * Number of items in folder\n   */\n  itemCount: number;\n\n  /**\n   * Array of items to display\n   */\n  items: TItem[];\n\n  /**\n   * Render function for each item\n   * @param item - The item to render\n   * @param index - The item's index in the items array\n   * @returns React node to render for this item\n   */\n  renderItem: (item: TItem, index: number) => React.ReactNode;\n\n  /**\n   * Singular label for items (used in badge)\n   * @default \"Item\"\n   */\n  itemLabel?: string;\n\n  /**\n   * Plural label for items (used in badge)\n   * @default \"Items\"\n   */\n  itemLabelPlural?: string;\n\n  /**\n   * Empty state message when folder contains no items\n   * @default \"No items in this folder\"\n   */\n  emptyText?: string;\n\n  /**\n   * Fallback label for sort button\n   * @default \"Sort\"\n   */\n  sortLabel?: string;\n\n  /**\n   * Default expanded state\n   * @default true\n   */\n  defaultExpanded?: boolean;\n\n  /**\n   * Available sort options\n   */\n  sortOptions?: SortOption[];\n\n  /**\n   * Currently selected sort value\n   */\n  selectedSort?: string;\n\n  /**\n   * Sort option change handler\n   */\n  onSortChange?: (value: string) => void;\n\n  /**\n   * Drop handler for drag & drop\n   * @param itemId - ID of the item being dropped\n   * @param folderId - ID of the target folder\n   * @param index - Position index where the item will be inserted (optional, defaults to end)\n   */\n  onDrop?: (itemId: string, folderId: string, index?: number) => void;\n\n  /**\n   * Rename folder handler\n   */\n  onFolderEdit?: () => void;\n\n  /**\n   * Delete folder handler\n   */\n  onFolderDelete?: () => void;\n\n  /**\n   * Invite participants to folder handler\n   */\n  onFolderInvite?: () => void;\n\n  /**\n   * Is this folder currently a valid drop target\n   * @internal\n   */\n  isDropTarget?: boolean;\n\n  /**\n   * Briefly set to true after a successful drop for micro-feedback\n   * @internal\n   */\n  isDropCompleted?: boolean;\n\n  /**\n   * Callback when drag enters folder (for syncing @dnd-kit state)\n   * @internal\n   */\n  onDragEnter?: () => void;\n\n  /**\n   * Callback when drag leaves folder (for syncing @dnd-kit state)\n   * @internal\n   */\n  onDragLeaveFolder?: () => void;\n}\n"
    },
    {
      "path": "packages/react/src/sections/CollapsibleFolder/index.ts",
      "type": "registry:index",
      "content": "/**\n * CollapsibleFolder Section Exports\n *\n * Exports for the CollapsibleFolder section and its types.\n */\n\nexport { CollapsibleFolder } from \"./CollapsibleFolder\";\nexport type {\n  CollapsibleFolderProps,\n  SortOption,\n} from \"./CollapsibleFolder.types\";\n"
    }
  ],
  "preview": {
    "url": "https://orion-ds.dev/library.html#collapsible-folder",
    "local": "/library.html#collapsible-folder"
  },
  "import": "import { CollapsibleFolder } from '@orion-ds/react'",
  "cssImport": "import '@orion-ds/react/styles.css'"
}
